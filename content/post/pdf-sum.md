---
title: Считаем сумму из PDF.
author: ctrlok
layout: post
date: 2013-08-03
dsq_thread_id:
  - 2148545312
categories:
  - shell
tags:
  - pdfgrep
  - маленькие трюки

---
Сегодня понадобилось посчитать сумму некоторых позоций из счетов выставленных в pdf. Если говорить грубо &#8212; выдернуть текст из pdf, распарсить его и посчитать сумму.

Начнем с того что я жутко ленивый. Поэтому руками делать это я не захотел и нашел отличный инструмент &#171;pdftotext&#187;.

Синтаксис утилиты очень простой:

{{< highlight bash "style=friendly" >}}
$ pdftotext filename.pdf filename.txt
{{< /highlight >}}


Но нам нужен не один файл, а много. Поэтому мы будем использовать find.

{{< highlight bash "style=friendly" >}}
$ find ./ -name "*.pdf" -exec echo "{}" ; -exec pdftotext {} - ;
{{< /highlight >}}

Как мы видим выше &#8212; find ищет все файлы в директории в которой мы находимся и которые заканчиваются на pdf. Для дальнейшего грепа я бы рекомендовал добавить в имя к этим файлам какую-то случайную строку. Если имена файлов не нужны &#8212; можно не добавлять.

Теперь грепаем нужный текст &#8212; я думаю с этим каждый справится и получаем текст, который парсим в цифры при помощи awk.

После такого нехитрого действия мы получаем список чисел вроде:

{{< highlight bash "style=friendly" >}}
220
550
72
{{< /highlight >}}


Но нам же надо еще и посчитать? Тут в дело вступает консольный калькулятор bc. Он умеет считать выражения, которые поступают к нему на STDIN

{{< highlight bash "style=friendly" >}}
$ echo "2+3" | bc
{{< /highlight >}}


Теперь нам надо создать выражение которое будем передавать на вход bc. Нет ничего проще.

Добавляем в конец пайпа преобразование и можно передавать выражение bc.

{{< highlight bash "style=friendly" >}}
$ paste -s -d &#039;&#039; | sed "s/+$//"
{{< /highlight >}}


В итоге мы получим что-то вроде этого:

{{< highlight bash "style=friendly" >}}
$ find ./ -name "*.pdf" -exec echo "{}" ; -exec pdftotext {} - ; |\
    SuperMegaGrep |\
    paste -s -d &#039;&#039; |\
    sed "s/+$//" |\
    bc
{{< /highlight >}}


Вопрос решен ^)
