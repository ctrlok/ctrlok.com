---
title: 'О devops'
author: ctrlok
layout: post
draft: true
date: 2016-05-26
---

Допустим у нас есть бизнес — разработка чего-то. Соответственно внутри у нас уже есть несколько команд, которые разрабатывают различные компоненты. Они могут разрабатывать на одном языке, или на разных, но стоит знать что разные команды делают это по разному исходя из своих требований: кто-то может позволить себе stateless, кто-то нет, кто-то хочет использовать какие-то архитектурные решение, а кто-то просто не может в силу специфики продукта или сервиса, который они делают. В своих рассуждениях я беру за начальную точку что все команды имеют разные задачи и стараются сделать их максимально точно и максимально простым способом.

# Опс
В какой-то момент становится очевидным то, что команды, пусть и решают разные задачи, но некоторые вещи у них общие, на некоторые вопросы ответ будет один и тот же независимо от того делаешь ты базу данных, биллинг или пишешь какую-то логику.
Соответственно, если можно выделить что-то общее, то можно сформировать отдел людей, которые будут заниматься только этими вещами. Давайте сформулируем почему такое решение выгодно:

## Экономия на разнице стоимости работы
Если у нас есть дорогой девелопер, время которого стоит 30 долларов в час, то зачем ему делать ту работу, с которой справляет человек стоимостью 10 долларов в час? Если выделить всю низкооплачиваемую и простую работу, то можно экономить. К тому же дорогой девелопер будет делать сложные задачи, которые ему интересны, а дешёвый опс – простые, которые девелоперу не интересны.
![](/images/devops/price.png)

## Экономия на простоях
Если внутри команды есть люди, которые занимаются конкретными задачами, то между решениями задач у них будет время простоя, пока команда не сгенерирует новые задачи.
![](/images/devops/idle.png)
Объединяя людей в общий отдел можно "шарить" людей на несколько команд и получать от этого выгоду.

## Экономия на экспертизе
Если есть общие вещи для всех, то разные отделы всё равно приходят к более-менее одним и тем же решениям. Развивать экспертизу сразу в нескольких командах всегда дороже, чем содержать нескольких экспертов, которые решат задачу и быстрее, и качественнее.
![](/images/devops/mastery.png)
К тому же имея несколько экспертов, которые замещают друг друга можно не бояться за то, что кто-то станет незаменимым просто потому что никто кроме него не умеет обновлять хитрый сетап.

# Опс эра

В до-девопс эру принято было выделять в отдельный отдел такие штуки (я для удобства сразу прописал что из этого к какому стимулу относится)

1. Настройка производительности OS (экспертиза)
2. Управление базами данных (экспертиза)
3. Работа с другим open source софтом (экспертиза)
4. Мониторинг продукта (экспертиза)
5. Доставка обновлений продукта (экспертиза/стоимость)
6. Производительность продукта (экспертиза)
7. Управление серверами\инфраструктурой (экспертиза/стоимость)
8. Бекапы (экспертиза/стоимость)
9. Безопасность (экспертиза)
10. Обеспечение стабильности работы (экспертиза/стоимость)
11. Мелкая поддержка 24/7 (стоимость)

Самое смешное, что почти всё из списка выше — вопрос экспертизы: когда люди которые умеют что-то делать помогают другим людям, которые не умеют этого делать. Соответственно редко получается нанять дешёвого человека, который будет опытным и при этом не против поделать какую-то рутинную фигню.

![Поковырять легаси? Отличная идея!](/images/devops/shiva.png)

Так как занимать дорогих спецов рутиной не получается, а дешёвые спецы творят фигню, то обычно внутри такой команды формировалась (эволюционно или специально) структура разделения запросов в зависимости от сложности.

Вроде звучит здорово. Но… Как мы все знаем, чаще всего чем больше хопов, тем выше латенси. Соответственно такая структура повышает время решения любой задачи. К тому же обычно в этом месте возникают всякие ботлнеки.

А ещё, как мы знаем любой человек или группа людей делает только то, что от них требуют. Соответственно у нас появляются команды у которых в приоритете новые фичи и одна команда, которая отвечает за стабильность. И если у этих команд нет ничего общего, то начинается [игра с нулевой суммой]. И ничем хорошим она обычно не заканчивается. Опсы хотят стабильности настолько что саботируют фичи и новые технологии, а девы хотят как можно меньше заниматься чем-то, кроме фичей, потому что именно по этой метрике их судит бизнес.

![Поковырять легаси? Отличная идея!](/images/devops/prod.png)

В итоге страдает культура внутри компаний и понижается конкурентоспособность за счёт того что бизнес перестаёт использовать все те возможности, которые мог бы использовать. К тому же проблема роста одного отдела, количество задач которого зависит от других отделов это… Очень сложная проблема. Как-то поговорим отдельно :)



# devops

Столкнувшись с проблемами выше можно сделать такой вывод: давайте нанимать дорогих специалистов, которые будут автоматизировать рутинные задачи и при помощи всяких культурных штук оформим диалог людей которые поддерживают продукт с теми кто его деплоит. Самое странное, что про вторую часть часто забывают, поэтому сейчас девопс размыт и под ним понимают как и опсов, которые автоматизируют свои задачи, так и девов, которые всё делают сами.

Для уменьшения задержек в игре с нулевой суммой мы делаем команды инженеров ответственными как за новые фичи, так и за стабильность работы продукта. Потому как одно так и второе это то, что ждёт пользователь, а если надо строить приоритеты между стабильностью и скоростью то лучше это делать в одной команде, чем на бесконечных совещаниях двух команд с противоположными целями.

Внимательный читатель обратит внимание, что почти всё что делал опс отдел связано с стабильностью и будет прав. Всё что можно вынести должно быть вынесено в команды, в которых оно используется.

Я знаю, это очень громкое утверждение. Проблемы с которыми сталкиваются при таком подходе были описаны ещё в начале этой статьи. Давайте подумаем как можно решить эти проблемы другим путём? Что если у нас будет отдел, который при помощи автоматизации уберёт рутинные задачи и будет иметь необходимую экспертизу чтобы делиться ей с другими командами? Одни проблемы могут быть решены обучением и совместным внедрением, а другие (в том числе и шаринг экспертизы) — скриптами. А то немногое что общее для всех может стать внутренним продуктом, который эта команда будет предоставлять.

1. Настройка производительности OS (автоматизация/обучение/совместные проекты)
2. Управление базами данных (автоматизация/внутренний SaaS)
3. Работа с другим open source софтом (автоматизация/внутренние best practices/ответственность команд)
4. Мониторинг продукта (автоматизация/внутренний SaaS/обучение)
5. Доставка обновлений продукта (автоматизация)
6. Производительность продукта (ответственность команд)
7. Управление серверами\инфраструктурой (автоматизация)
8. Бекапы (автоматизация)
9. Безопасность (экспертиза/обучение/автоматизация/совместные проекты)
10. Обеспечение стабильности работы (автоматизация/обучение)
11. Мелкая поддержка 24/7 (автоматизация?)

И получается что сложные и общие вопросы решает одна команда, а все остальные команды не следят за тем как обновляется графит или как меняются тренды докеров. Они просто используют внутренние продукты и утилиты, которые и являются лучшими практиками.
Никто не пишет свой мониторинг, никто не придумывает своё докерное извращение — об это думает  специальная команда.
Но если вы хотите получать метрики и доставлять свои приложения на продакшн у вас есть набор утилит/практик как это делать правильно. И не надо каждый раз изобретать велосипед и получать экспертизу там, где она вам не нужна.

Подобная схема удобна. Команда опсов превращается в мульти команду инженеров, которая занимается всем чем может и помогает везде где надо. В итоге в список задач может прийти и переписывание/оптимизация высокопроизводительного кода или внутренний амазон. Такая команда становится гибче за счёт того что у неё есть продукты, которые она делает. Она может выставлять собственные приоритеты ориентируясь на общее инженерное виденье. А девы, наоборот приближаются к проду и это достаточно благостно и отрезвляюще влияет на продукт менеджмент. Если вы отвечаете за пользовательский опыт, то обычно очень быстро находите нужную и выгодную именно вам точку между стабильностью и новыми возможностями.
К тому же данная схема вместо сосредоточения умений в одних руках способствует шарингу знаний и новому опыту.
Хочешь использовать тарантул, монгу, очереди, постгрю? Не надо упрашивать опсов чтобы они этим занялись. Ставь и зарабатывай свой опыт. Но отвечаешь за это тоже ты.
И если всё идёт правильно, то побеждают те, кто берёт на себя ответственность, а не тот, кто лучше всех перекладывает её на других. Это ведь здорово, правда?

Для того чтобы devops заработал в него надо вложить немало сил. Но кроме этого много сил надо и для поддержки. Надо постоянно учиться, постоянно искать что можно сделать лучше и делать это лучше. Надо думать не только о сегодняшнем дне, но и том что будет через год. Со стороны этой общей экспертной команды надо всегда смотреть на несколько шагов вперёд и стараться облегчить жизнь другим. Надо делать продукты максимально автономными и в меру абстрактными. Такими, чтобы они подходили как можно большему количеству инженеров. Сделать так, что бы у остальных команд было как можно меньше проблем. А другие продуктовые команды должны принять на себя ответственность за свой продукт, ответственность за опыт своих пользователей и постоянно пересматривать свой продукт с стороны этого опыта. Мы в Grammarly сделали ставку на devops. И, кстати, мы хайрим(ссылка)
